<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="javis.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="clr-namespace:javis.UI.Controls"
        Title="JARVIS"
        Width="1440" Height="720"
        MinWidth="1200" MinHeight="720"
        WindowStyle="None"
        ResizeMode="CanResize"
        Background="{DynamicResource WindowBackgroundGradientBrush}"
        PreviewKeyDown="MainWindow_PreviewKeyDown"
        FontFamily="Segoe UI, Malgun Gothic, Segoe UI Emoji">

	<Window.Resources>
		<LinearGradientBrush x:Key="WindowBackgroundGradientBrush" StartPoint="0,0" EndPoint="1,1">
			<GradientStop Color="#FF1A1A2E" Offset="0"/>
			<GradientStop Color="#FF211A3E" Offset="1"/>
		</LinearGradientBrush>

		<Style x:Key="JaeminPanelToggleStyle" TargetType="ToggleButton">
			<Setter Property="Width" Value="40"/>
			<Setter Property="Height" Value="40"/>
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Padding" Value="0"/>
			<Setter Property="FocusVisualStyle" Value="{x:Null}"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ToggleButton">
						<Border Background="{TemplateBinding Background}"
                                SnapsToDevicePixels="True"
                                Width="{TemplateBinding Width}"
                                Height="{TemplateBinding Height}">
							<Image Source="pack://application:,,,/Assets/Persona/jaemin_face.png"
                                   Width="{TemplateBinding Width}" Height="{TemplateBinding Height}"
                                   Stretch="UniformToFill"
                                   SnapsToDevicePixels="True"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   RenderTransformOrigin="0.5,0.5">
								<Image.RenderTransform>
									<ScaleTransform ScaleX="1.7" ScaleY="1.7"/>
								</Image.RenderTransform>
							</Image>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter Property="Opacity" Value="0.95"/>
							</Trigger>
							<Trigger Property="IsPressed" Value="True">
								<Setter Property="Opacity" Value="0.9"/>
							</Trigger>
							<Trigger Property="IsEnabled" Value="False">
								<Setter Property="Opacity" Value="0.55"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
	</Window.Resources>

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="953*"/>
			<ColumnDefinition Width="248*"/>
		</Grid.ColumnDefinitions>
		<ui:ScaleToFitDecorator DesignWidth="1440" DesignHeight="720" AlignToTopLeft="True" Stretch="Uniform"
								UseLayoutRounding="True"
								SnapsToDevicePixels="True"
								TextOptions.TextFormattingMode="Display"
								TextOptions.TextRenderingMode="ClearType"
								RenderOptions.ClearTypeHint="Enabled" Grid.ColumnSpan="2">
			<Grid Width="1440" Height="720">
				<!-- Background: force dark theme color -->
				<Border Background="{DynamicResource AppBackgroundBrush}"/>

				<Canvas IsHitTestVisible="False"/>
			</Grid>
		</ui:ScaleToFitDecorator>

		<!-- Body (NOT scaled) -->
		<Grid Grid.ColumnSpan="2" Margin="0,40,0,0">
			<Grid.ColumnDefinitions>
				<ColumnDefinition x:Name="LeftNavCol" Width="250"/>
				<ColumnDefinition x:Name="LeftGapCol" Width="72"/>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition x:Name="RightRailCol" Width="18"/>
				<ColumnDefinition x:Name="RightPanelCol" Width="250"/>
			</Grid.ColumnDefinitions>

			<!-- Left nav -->
			<Border x:Name="LeftNavHost" Grid.Column="0" Background="Transparent" Padding="0" HorizontalAlignment="Stretch" Margin="0">
				<Border CornerRadius="18" Background="{DynamicResource CardBackgroundBrush}" BorderBrush="#33FFFFFF" BorderThickness="1" Padding="0" Margin="0">
					<StackPanel>
						<TextBlock Text="JARVIS"
								   FontWeight="Bold"
								   FontSize="18"
								   Margin="10,8,0,10"
								   Foreground="#FF8A6BFF">
							<TextBlock.Effect>
								<DropShadowEffect BlurRadius="5" ShadowDepth="0" Opacity="0.55" Color="#FF8A6BFF"/>
							</TextBlock.Effect>
						</TextBlock>

						<ListBox x:Name="Nav"
								 Background="Transparent"
								 BorderThickness="0"
								 FontSize="16"
								 SelectionChanged="Nav_SelectionChanged">

						<ListBoxItem Tag="home" Content="Home" />
						<!-- NOTE: Legacy Chat navigation removed. Main navigation is simplified (Home/MainAiWidget/Settings). -->
						<ListBoxItem Tag="todos" Content="Todos" />
						<ListBoxItem Tag="map" Content="Map" />
						<ListBoxItem Tag="skills" Content="Skills" />
						<ListBoxItem Tag="settings" Content="Settings" />
					</ListBox>
					</StackPanel>
				</Border>
			</Border>

			<!-- Combined area: Calendar(top) + Summary(bottom) -->
			<Grid Grid.Column="2">
				<Grid.RowDefinitions>
					<RowDefinition Height="1.25*"/>
					<RowDefinition Height="18"/>
					<RowDefinition Height="0.75*"/>
				</Grid.RowDefinitions>

				<Border Grid.Row="0" Style="{StaticResource LargePanelPink}" Margin="0,0,0,18" Grid.RowSpan="2">
					<Frame x:Name="MainFrame" NavigationUIVisibility="Hidden" />
				</Border>

				<Border Grid.Row="2" Style="{StaticResource LargePanelMint}" Margin="0">
					<Frame x:Name="AuxFrame" NavigationUIVisibility="Hidden" />
				</Border>
			</Grid>

			<!-- Right panel toggle rail: only used when panel is collapsed (floating button is outside ScaleToFit) -->
			<Grid Grid.Column="3" Width="0" />

			<!-- Right (blue) panel -->
			<Border x:Name="RightPanelHost" Grid.Column="4" Style="{StaticResource LargePanelBlue}" Margin="0">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
					</Grid.RowDefinitions>

					<Border Grid.Row="0"
							CornerRadius="18"
							Background="{DynamicResource CardBackgroundBrush}"
							BorderBrush="{DynamicResource PrimaryBrush}"
							BorderThickness="1"
							Padding="6,4"
							MinHeight="48"
							Margin="0,0,0,12">
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>

							<ToggleButton x:Name="RightPanelToggle"
											  Grid.Column="0"
											  Margin="0,0,8,0"
											  Width="40"
											  Height="40"
											  VerticalAlignment="Center"
											  IsChecked="True"
											  Checked="RightPanelToggle_Checked"
											  Unchecked="RightPanelToggle_Unchecked"
											  ToolTip="재민 패널 토글"
											  Style="{StaticResource JaeminPanelToggleStyle}" />

							<TextBlock Grid.Column="1"
									   Text="재민 - AI 관리자"
									   FontSize="14"
									   FontWeight="SemiBold"
									   Foreground="{DynamicResource TextPrimaryBrush}"
										   VerticalAlignment="Center"
										   HorizontalAlignment="Center"/>
						</Grid>
					</Border>

					<ui:MainAiWidget Grid.Row="1"
								 x:Name="MainAiWidget"
								 Margin="0"
								 HorizontalAlignment="Stretch"
								 VerticalAlignment="Stretch"/>
				</Grid>
			</Border>
		</Grid>

		<!-- Title bar overlay (not scaled): stays at actual window top-right -->
		<Border x:Name="TitleBarHost"
                Height="40"
                Background="#FF252545"
                VerticalAlignment="Top"
                MouseLeftButtonDown="TitleBar_MouseLeftButtonDown" Grid.ColumnSpan="2">
			<DockPanel LastChildFill="True" Margin="0">
				<StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,4,6,4">
					<Button Click="Min_Click" Style="{StaticResource TitleBarButton}">
						<TextBlock Text="_" FontSize="14" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="#FF00D2FF"/>
					</Button>
					<Button Click="Max_Click" Margin="6,0,0,0" Style="{StaticResource TitleBarButton}">
						<TextBlock Text="[]" FontSize="12" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="#FF00D2FF"/>
					</Button>
					<Button Click="Close_Click" Margin="6,0,0,0" Style="{StaticResource TitleBarButton}" Tag="Close">
						<TextBlock Text="X" FontSize="14" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="#FF00D2FF"/>
					</Button>
				</StackPanel>

				<TextBlock Visibility="Collapsed" />
			</DockPanel>
		</Border>

		<!-- Title bar bottom divider -->
		<Border Height="1" Background="#FF3A3A5A" VerticalAlignment="Top" Margin="0,40,0,0" Grid.ColumnSpan="2"/>

		<!-- Floating Jaemin panel toggle (visible only when panel is collapsed) -->
		<ToggleButton x:Name="RightPanelFloatingToggle"
                      HorizontalAlignment="Right"
                      VerticalAlignment="Top"
                      Margin="0,52,20,0"
                      Width="40"
                      Height="40"
                      ToolTip="재민 패널 열기"
                      Visibility="Collapsed"
                      Checked="RightPanelToggle_Checked"
                      Style="{StaticResource JaeminPanelToggleStyle}" Grid.Column="1" />
	</Grid>
</Window>
